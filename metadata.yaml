title: "U.S. Military Base Slot Machine Revenue Explorer"
description: >
  Interactive Datasette deployment that surfaces FY2020-FY2024 slot machine
  revenue reported by U.S. military installations worldwide. Built from
  MuckRock FOIA responses and enriched with geocoded coordinates for mapping.
source: "MuckRock FOIA Request"
license: "Creative Commons Attribution 4.0"
about: "Datasette instance prepared for the DS 701 project team."
databases:
  military_slots:
    title: "Military Slot Machine Revenue (FY20-FY24)"
    description: >
      Monthly slot machine revenue for Army, Navy, and Marine Corps morale,
      welfare, and recreation (MWR) facilities aligned to fiscal years 2020
      through 2024 with coordinates for each installation.
    tables:
      slot_machine_revenue:
        title: "Slot Machine Revenue by Installation"
        description: >
          Each row represents the revenue reported by a specific facility on a
          military installation for a given fiscal month. Fiscal years follow
          the U.S. federal calendar (Oct-Sep).
        source: "U.S. military MWR slot machine financial disclosures"
        columns:
          installation_name: "Official installation name reported in the FOIA response."
          facility_name: "Name of the club, community center, or other venue housing the slot machines."
          branch: "Military branch responsible for the facility (Army, Navy, USMC)."
          district: "Geographic district or theater (e.g., Japan, Europe, Korea)."
          category: "Reported ledger category (Revenue or Expense)."
          calendar_year: "Calendar year for the entry as provided in the PDF."
          fiscal_year: "U.S. federal fiscal year that the month rolls up to (Oct-Sep)."
          month_name: "Name of the month for the record."
          month_number: "Integer month number (1-12) used for ordering."
          revenue: "Total slot machine revenue in U.S. dollars."
          latitude: "Installation latitude for mapping."
          longitude: "Installation longitude for mapping."
        sort_desc: revenue
        facets:
          - branch
          - district
          - fiscal_year
          - installation_name
        plugins:
          datasette-cluster-map:
            latitude_column: latitude
            longitude_column: longitude
    queries:
      branch_revenue_summary:
        title: "Branch Revenue Overview"
        description: "Counts installations and aggregates revenue per branch."
        sql: |
          select
            branch,
            count(distinct installation_name) as installations,
            round(sum(revenue), 2) as total_revenue,
            round(avg(revenue), 2) as avg_monthly_revenue
          from slot_machine_revenue
          group by branch
          order by total_revenue desc;
      top_installations:
        title: "Top 10 Installations by Revenue"
        description: "Shows the highest grossing installations across the full timeframe."
        sql: |
          select
            installation_name,
            branch,
            district,
            round(sum(revenue), 2) as total_revenue
          from slot_machine_revenue
          group by installation_name, branch, district
          order by total_revenue desc
          limit 10;
      fiscal_trends:
        title: "Revenue Trends by Fiscal Year and Branch"
        description: "Breaks out aggregate revenue per fiscal year and branch."
        sql: |
          select
            fiscal_year,
            branch,
            round(sum(revenue), 2) as total_revenue
          from slot_machine_revenue
          group by fiscal_year, branch
          order by fiscal_year desc, total_revenue desc;
      revenue_by_district:
        title: "Revenue by District"
        description: "Aggregates total revenue and installation counts per geographic district."
        sql: |
          select
            district,
            count(distinct installation_name) as installations,
            round(sum(revenue), 2) as total_revenue
          from slot_machine_revenue
          group by district
          order by total_revenue desc;
      branch_district_revenue:
        title: "Branch vs District Revenue and Per-Base Average"
        description: "Total revenue, base counts, and per-base averages grouped by branch and district."
        sql: |
          select
            branch,
            district,
            count(distinct installation_name) as installations,
            round(sum(revenue), 2) as total_revenue,
            round(sum(revenue) / count(distinct installation_name), 2) as revenue_per_base
          from slot_machine_revenue
          group by branch, district
          order by branch, total_revenue desc;
      top_bases_by_year_branch:
        title: "Top Bases by Fiscal Year and Branch"
        description: "Ranks installations within each fiscal year and branch by total revenue."
        sql: |
          with totals as (
            select
              installation_name,
              branch,
              fiscal_year,
              round(sum(revenue), 2) as total_revenue
            from slot_machine_revenue
            where fiscal_year is not null
            group by installation_name, branch, fiscal_year
          )
          select
            installation_name,
            branch,
            fiscal_year,
            total_revenue,
            rank() over (partition by branch, fiscal_year order by total_revenue desc) as rank_in_branch_year
          from totals
          order by fiscal_year desc, branch, rank_in_branch_year
          limit 200;
plugins:
  datasette-vega: {}
  datasette-dashboards:
    slot_machine_overview:
      title: "Slot Machine Revenue Overview"
      description: "Key metrics, geographies, trends, and top installations from FY2020-FY2024."
      cards:
        - type: markdown
          content: |
            ### Project Snapshot
            - Data source: MuckRock FOIA responses (Army, Navy, USMC)
            - Coverage: Fiscal Years 2020-2024
            - Plugins: datasette-cluster-map, datasette-vega, datasette-dashboards
        - type: query
          database: military_slots
          query: branch_revenue_summary
          title: "Revenue by Branch"
          display: table
        - type: query
          database: military_slots
          query: branch_district_revenue
          title: "Branch vs District Heatmap"
          display: vega
          chart:
            mark: bar
            encoding:
              x: { field: region, type: nominal, sort: "-y" }
              y: { field: branch, type: nominal }
              color: { field: total_revenue, type: quantitative, scale: { scheme: "blues" } }
        - type: query
          database: military_slots
          query: fiscal_trends
          title: "Fiscal-Year Trends"
          display: vega
          chart:
            mark: line
            encoding:
              x: { field: fiscal_year, type: ordinal }
              y: { field: total_revenue, type: quantitative }
              color: { field: branch, type: nominal }
        - type: query
          database: military_slots
          query: top_installations
          title: "Top 10 Installations"
          display: table
        - type: query
          database: military_slots
          query: top_bases_by_year_branch
          title: "Rankings by Branch + FY"
          display: table
